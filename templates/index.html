<label for="item">Select Item:</label>
<select id="item" onchange="updateModels()">
    <option value="">-- Select --</option>
    {% for item in items %}
    <option value="{{ item }}">{{ item }}</option>
    {% endfor %}
</select>

<div id="models-container"></div>

<label for="quantity">Quantity:</label>
<input type="number" id="quantity" min="1" value="1" />

<label for="description">Description:</label>
<input type="text" id="description" readonly />

<label for="unit-price">Unit Price:</label>
<input type="text" id="unit-price" readonly />

<label for="total">Total:</label>
<input type="text" id="total" readonly />

<label for="vat">VAT (15%):</label>
<input type="text" id="vat" readonly />

<label for="total-with-vat">Total with VAT:</label>
<input type="text" id="total-with-vat" readonly />

<button onclick="calculatePrice()">Calculate</button>

<script>
    function updateModels() {
        const item = document.getElementById('item').value;

        if (item) {
            fetch('/get_models', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ item })
            })
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('models-container');
                container.innerHTML = '<label for="model">Select Model:</label><select id="model">';
                const select = document.getElementById('model');
                data.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.Model;
                    option.textContent = `${model.Model} - ${model.Description}`;
                    select.appendChild(option);
                });
                container.appendChild(select);
            });
        }
    }

    function calculatePrice() {
        const model = document.getElementById('model').value;
        const quantity = document.getElementById('quantity').value;

        if (model && quantity) {
            fetch('/calculate_price', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ model, quantity })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('description').value = data.description;
                document.getElementById('unit-price').value = data.unit_price;
                document.getElementById('total').value = data.total;
                document.getElementById('vat').value = data.vat;
                document.getElementById('total-with-vat').value = data.total_with_vat;
            });
        }
    }
</script>
